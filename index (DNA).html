<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>M√¥ ph·ªèng t√°i b·∫£n DNA ‚Äì Design by Fubao</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
<style>
  body {
    background: radial-gradient(circle at center, #001020, #000814);
    font-family: "Segoe UI", sans-serif;
    color: #fff;
    text-align: center;
  }
  h2 {
    color: #6cfaff;
    margin-top: 10px;
    text-shadow: 0 0 10px #6cfaff;
  }
  p {
    color: #a0e6ff;
    text-shadow: 0 0 5px #4edfff;
  }
  canvas {
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,255,255,0.3);
    margin-top: 10px;
  }
  footer {
    margin-top: 12px;
    font-size: 14px;
    color: #6cfaff;
    text-shadow: 0 0 5px #00ffe0;
  }
</style>
</head>
<body>
  <h2>üß¨ M√¥ ph·ªèng qu√° tr√¨nh t√°i b·∫£n DNA</h2>
  <p>(1Ô∏è‚É£ Gyrase + Helicase ‚Üí 2Ô∏è‚É£ Polymerase √ó2 ‚Üí 3Ô∏è‚É£ Ligase ‚Üí 4Ô∏è‚É£ Ho√†n t·∫•t)</p>

  <script>
  let bases = [];
  const numBases = 15;
  const spacing = 55;
  const baseRadius = 14;
  let gyraseX=-80, helicaseX=-60, poly1X=-120, poly2X=-120, ligaseX=-150;
  let stage=0;
  const speed = 0.6;
  const colors = { A:'#ff7676', T:'#6caeff', C:'#1dd3b0', G:'#ffd93d' };
  let glowTimer = 0;
  let bgMusic, clickSound;

  function preload(){
    // Nh·∫°c n·ªÅn ambient v√† √¢m click nh·∫π (s·ª≠ d·ª•ng URL h·ª£p l·ªá)
    bgMusic = new Audio("https://cdn.pixabay.com/download/audio/2021/09/28/audio_8b2fbe223a.mp3?filename=soft-ambient-background-12821.mp3");
    bgMusic.loop = true;
    bgMusic.volume = 0.35;

    clickSound = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_b5ffcd3972.mp3?filename=button-click-124467.mp3");
    clickSound.volume = 0.4;
  }

  function setup() {
    createCanvas(1150, 560);
    textFont("Segoe UI");
    initDNA();
    bgMusic.play().catch(()=>{});
  }

  function initDNA() {
    bases=[];
    const seq=['A','T','G','C','C','A','T','G','A','C','T','T','A','G','C'];
    for(let i=0;i<numBases;i++){
      bases.push({
        base:seq[i], comp:complement(seq[i]),
        open:false, newTop:false, newBottom:false,
        pairedTop:false, pairedBottom:false, joined:false
      });
    }
  }

  function complement(b){ return b==='A'?'T':b==='T'?'A':b==='C'?'G':'C'; }

  function draw(){
    background(0,20,40);
    glowTimer += 0.1;
    translate(width/2-(numBases*spacing)/2, height/2);
    updateStage();

    for(let i=0;i<numBases;i++){
      const x=i*spacing;
      const b=bases[i];

      // M·∫°ch g·ªëc
      drawBase(x,-40,b.base,colors[b.base]);
      drawBase(x, 40,b.comp,colors[b.comp]);

      if(!b.open) drawHydrogenCurved(x,-40,40,b.base,b.comp);

      stroke(80);
      if(i<numBases-1){
        line(x+baseRadius+4,-40,x+spacing-(baseRadius+4),-40);
        line(x+baseRadius+4, 40,x+spacing-(baseRadius+4), 40);
      }

      // M·∫°ch m·ªõi tr√™n
      if(b.newTop){
        let newColor = colors[complement(b.base)];
        const glow = 80 + 60*sin(glowTimer);
        drawBaseGlow(x,-85,complement(b.base),newColor,glow);
        if(b.pairedTop) drawHydrogenCurved(x,-85,-40,b.base,complement(b.base));
        if(i<numBases-1 && bases[i+1].newTop){
          stroke(newColor);
          line(x+baseRadius+4,-85,x+spacing-(baseRadius+4),-85);
        }
      }

      // M·∫°ch m·ªõi d∆∞·ªõi
      if(b.newBottom){
        let newColor = colors[complement(b.comp)];
        const glow = 80 + 60*sin(glowTimer);
        drawBaseGlow(x,85,complement(b.comp),newColor,glow);
        if(b.pairedBottom) drawHydrogenCurved(x,85,40,b.comp,complement(b.comp));
        if(i<numBases-1 && bases[i+1].newBottom){
          stroke(newColor);
          line(x+baseRadius+4,85,x+spacing-(baseRadius+4),85);
        }
      }

      // Ligase n·ªëi
      if(b.joined && i<numBases-1){
        stroke(255,200,80);
        strokeWeight(2);
        line(x+baseRadius+4,85,x+spacing-(baseRadius+4),85);
        strokeWeight(1);
      }
    }

    drawEnzymes();

    // Giai ƒëo·∫°n
    resetMatrix();
    textAlign(CENTER);
    textSize(18);
    fill("#6cfaff");
    let stageText = "";
    if(stage===0) stageText = "Giai ƒëo·∫°n 1Ô∏è‚É£: Gyrase v√† Helicase ƒëang th√°o xo·∫Øn, t√°ch hai m·∫°ch DNA.";
    else if(stage===1) stageText = "Giai ƒëo·∫°n 2Ô∏è‚É£: Hai Polymerase t·ªïng h·ª£p m·∫°ch b·ªï sung v√† h√¨nh th√†nh li√™n k·∫øt hiƒër√¥.";
    else if(stage===2) stageText = "Giai ƒëo·∫°n 3Ô∏è‚É£: Ligase n·ªëi c√°c ƒëo·∫°n Okazaki, ho√†n thi·ªán m·∫°ch ch·∫≠m.";
    else stageText = "Giai ƒëo·∫°n 4Ô∏è‚É£: Ho√†n t·∫•t! Hai ph√¢n t·ª≠ DNA m·ªõi ƒë∆∞·ª£c t·∫°o ra (b√°n b·∫£o to√†n).";
    text(stageText, width/2, 60);

    // Chi·ªÅu
    fill("#fff");
    textSize(14);
    text("3‚Ä≤", width/2-(numBases*spacing)/2-25, height/2-60);
    text("5‚Ä≤", width/2+(numBases*spacing)/2+25, height/2-60);
    text("5‚Ä≤", width/2-(numBases*spacing)/2-25, height/2+90);
    text("3‚Ä≤", width/2+(numBases*spacing)/2+25, height/2+90);
  }

  function drawBase(x,y,label,col){
    stroke(col);
    strokeWeight(2);
    fill(col+"33");
    ellipse(x,y,baseRadius*2,baseRadius*2);
    noStroke();
    fill(col);
    textAlign(CENTER,CENTER);
    textSize(12);
    text(label,x,y);
  }

  function drawBaseGlow(x,y,label,col,glow){
    noStroke();
    fill(col + "22");
    ellipse(x,y,baseRadius*2 + 10*sin(glowTimer),baseRadius*2 + 10*sin(glowTimer));
    stroke(col);
    strokeWeight(2);
    fill(col + "33");
    ellipse(x,y,baseRadius*2,baseRadius*2);
    noStroke();
    fill(col);
    textAlign(CENTER,CENTER);
    textSize(12);
    text(label,x,y);
  }

  // Li√™n k·∫øt H kh√¥ng c·∫Øt nucleotide
  function drawHydrogenCurved(x,y1,y2,b1,b2){
    const nLines = (b1==='G'&&b2==='C')||(b1==='C'&&b2==='G') ? 3 : 2;
    const offset = 3.5;
    const totalWidth = (nLines - 1) * offset;
    const startX = x - totalWidth / 2;
    const pad = 4;
    let yStart, yEnd;

    if (y1 < y2) {
      yStart = y1 + baseRadius + pad;
      yEnd   = y2 - baseRadius - pad;
    } else {
      yStart = y1 - baseRadius - pad;
      yEnd   = y2 + baseRadius + pad;
    }

    const midY = (yStart + yEnd) / 2;
    const ctrlOffset = Math.abs(yEnd - yStart) / 3;

    stroke(180,220,255);
    strokeWeight(1.1);
    noFill();

    for (let i = 0; i < nLines; i++) {
      const lx = startX + i * offset;
      if (y1 < y2) {
        bezier(lx, yStart, lx + 4, midY - ctrlOffset, lx - 4, midY + ctrlOffset, lx, yEnd);
      } else {
        bezier(lx, yStart, lx - 4, midY + ctrlOffset, lx + 4, midY - ctrlOffset, lx, yEnd);
      }
    }
  }

  function drawEnzymes(){
    if(stage===0){
      drawGlowCircle(gyraseX,-10,26,"#ff4747");
      drawGlowCircle(helicaseX,10,26,"#b580ff");
    } else if(stage===1){
      drawGlowCircle(poly1X,-100,24,"#57a8ff");
      drawGlowCircle(poly2X,100,24,"#57a8ff");
    } else if(stage===2){
      drawGlowCircle(ligaseX,85,26,"#ffc44d");
    }
  }

  function drawGlowCircle(x,y,r,col){
    noStroke();
    fill(col+"33");
    ellipse(x,y,r+10);
    fill(col);
    ellipse(x,y,r);
    stroke(col);
    strokeWeight(1.2);
  }

  function updateStage(){
    if(stage===0){
      gyraseX+=speed; helicaseX+=speed;
      const idx=int(helicaseX/spacing);
      if(idx>=0&&idx<numBases){ bases[idx].open=true; clickSound.play(); }
      if(helicaseX>numBases*spacing){ stage=1; poly1X=0; poly2X=0; }
    }
    else if(stage===1){
      poly1X+=speed; poly2X+=speed;
      const i1=int(poly1X/spacing), i2=int(poly2X/spacing);
      if(i1>=0&&i1<numBases){ bases[i1].newTop=true; bases[i1].pairedTop=true; clickSound.play(); }
      if(i2>=0&&i2<numBases){ bases[i2].newBottom=true; bases[i2].pairedBottom=true; clickSound.play(); }
      if(poly1X>numBases*spacing){ stage=2; ligaseX=0; }
    }
    else if(stage===2){
      ligaseX+=speed;
      const j=int(ligaseX/spacing);
      if(j>=0&&j<numBases){ bases[j].joined=true; clickSound.play(); }
      if(ligaseX>numBases*spacing) stage=3;
    }
  }
  </script>

  <footer>‚ú® Design by Fubao ‚ú®</footer>
</body>
</html>
